const token = "6827588902:AAH7p_1-clVPN-PxImDj2oZS_S54HBxOcsk";
const webAppUrl = "https://script.google.com/macros/s/AKfycbxdpkDe086WX5i3KdpQFelUIBXaoFfKagRFygJKwzrOsWdndYGhF4amSxbv9IA93z9GXA/exec";

function setWebhook() {
  let response = UrlFetchApp.fetch("https://api.telegram.org/bot" + token + "/setWebhook?url=" + webAppUrl);
  console.log(response.getContentText());
}
function doGet(e) {
  return HtmlService.createHtmlOutput("Hello World!! No, this link should be hidden!!!");

}


function doPost(e) {
  var body = JSON.parse(e.postData.contents);

  body.message.chat.id = body.message.chat.id + '';

  var payload = preparePayload(body);
  var data = {
    "method": "post",
    "contentType": 'application/json',
    "payload": JSON.stringify(payload),
  }

  UrlFetchApp.fetch("https://api.telegram.org/bot" + token + "/", data);
}
function preparePayload(body) {
  var payload;

  body.message.text = body.message.text.toLowerCase();
  body.message.text = body.message.text.replace(/@testlj001_bot/g, '');

  var paras = body.message.text.trim().split(" ");
  // remove empty strings
  paras = paras.filter(function (para) {
    if (para) {
      return true;
    }
  });

  if (body.message.text) {

    payload = {
      "method": "sendMessage",
      "chat_id": body.message.chat.id,
      "text": "æ¬¢è¿ä½¿ç”¨ã€TRXèƒ½é‡å…¨èƒ½æœºå™¨äººã€‘\n" + "ç§Ÿèƒ½é‡ã€å…‘æ¢TRXã€USDTåœ°å€ç›‘æ§ã€USDTä½™é¢æŸ¥è¯¢ã€USDTå®æ—¶æ±‡ç‡æŸ¥è¯¢ä¸€ç«™å¼æœåŠ¡\n" + "å®¢æœï¼š@mmmabc",
      "parse_mode": "Markdown",
    }

    if (body.message.text.indexOf("/start") === 0) {

      var command9 = [
        "ç§Ÿèƒ½é‡ â¤ï¸ ",
        "åœ°å€ç›‘å¬ ğŸ”¥",
        "é—ªå…‘TRX âœ¨",
      ];

      var replyKeyboardMarkup = {};
      replyKeyboardMarkup.keyboard = [];
      replyKeyboardMarkup.resize_keyboard = true;
      // replyKeyboardMarkup.one_time_keyboard = true;
      // replyKeyboardMarkup.selective = true;

      var count = 0;
      for (var i = 0; i < command9.length / 3; i++) {
        var keyboardRow = [];
        for (var j = 0; j < 3; j++) {
          var keyboardButton = {
            text: command9[i * 3 + j],
          };
          count++;
          keyboardRow.push(keyboardButton);
          if (count >= command9.length) {
            break;
          }

        }
        replyKeyboardMarkup.keyboard.push(keyboardRow);
      }
      payload.reply_markup = replyKeyboardMarkup;


      return payload;
    }

    if (body.message.text.indexOf("é—ªå…‘") === 0) {
      payload.text = "â–â–â–é—ªå…‘TRX âœ¨â–â–â–\n"
        + " \n"
        + "*ğŸ“ˆå®æ—¶æ±‡ç‡*"
        + " \n"
        + "1USDT = 8.5226 TRX \n"
        + "ç›®å‰åº“å­˜ï¼š2144.207015 TRX \n"
        + " \n"
        + " \n"
        + "ğŸ”„è‡ªåŠ¨å…‘æ¢åœ°å€: \n" 
        + " \n"
        + "ğŸ‘‡ ç‚¹å‡»ä¸‹æ–¹åœ°å€å¯å¤åˆ¶"
        + "`"
        + 'TGLhm7CRjSwCs7uH63T4N8wxyYdW6WSr7s'
        + "`"
        + " \n"
        + "ğŸš«è¯·ä¸è¦ä½¿ç”¨äº¤æ˜“æ‰€æˆ–å¹³å°é’±åŒ…è½¬è´¦â—ï¸åˆ‡è®°â€¼ï¸ \n"
        + " \n"
        + "ğŸªè½¬è´¦å³å…‘,å…¨è‡ªåŠ¨è¿”,ç­‰å€¼1Uèµ·å…‘ \n"
        + " \n"
        + "å®¢æœï¼š@mmmabc \n"
        ;
      return payload;
    }

    if (body.message.text.indexOf("åœ°å€ç›‘å¬") === 0) {
      payload.text = "âœ…ç‚¹å‡»æŒ‰é’®é€‰æ‹©ç½‘ç»œ";
      var inlineKeyboardMarkup = {};
      inlineKeyboardMarkup.inline_keyboard = [];
      var keyboardRow = [];
      var keyboardButton1 = {
        text: "ç›‘å¬æ³¢åœºé“¾",
        url: "https://tronscan.org/#/"
      };
      var keyboardRow2 = [];
      var keyboardButton2 = {
        text: "ç›‘å¬å¸å®‰é“¾",
        url: "https://bscscan.com/"
      };
      keyboardRow.push(keyboardButton1);
      keyboardRow2.push(keyboardButton2);
      inlineKeyboardMarkup.inline_keyboard.push(keyboardRow);
      inlineKeyboardMarkup.inline_keyboard.push(keyboardRow2);
      payload.reply_markup = inlineKeyboardMarkup;
      return payload;
    }

    // if(body.message.text.indexOf("/color") === 0){   
    //    payload.text = "çº¢\né»„\nè“";        
    //    return payload;
    // }

    if (body.message.text.indexOf("ç§Ÿèƒ½é‡") === 0) {
      payload.text = "â–â–â–ç§Ÿèƒ½é‡ â¤ï¸â–â–â–\n"
        + " \n"
        + "ğŸŒˆè½¬è´¦åˆ°ä¸‹é¢åœ°å€6ç§’è‡ªåŠ¨åˆ°è´¦èƒ½é‡:\n"
        + " \n"
        + "ğŸ”¸1ç¬”å¯¹æ–¹åœ°å€ã€æœ‰Uã€‘:  3 TRX   (1å°æ—¶æœ‰æ•ˆ):\n"
        + "ğŸ”¸1ç¬”å¯¹æ–¹åœ°å€ã€æ— Uã€‘:  6 TRX   (1å°æ—¶æœ‰æ•ˆ):\n"
        + " \n"
        + " \n"
        + "ğŸ”¸ä½¿ç”¨èƒ½é‡å¯ä»¥èŠ‚çœ80%è½¬Uæ‰‹ç»­è´¹:\n"
        + " \n"
        + "ğŸŒˆå•æ¬¡èƒ½é‡ä¸‹å•åœ°å€:\n"
        + " \n"
        + "ğŸ‘‡ ç‚¹å‡»ä¸‹æ–¹åœ°å€å¯å¤åˆ¶"
        + "`"
        + 'TGLhm7CRjSwCs7uH63T4N8wxyYdW6WSr7s'
        + "`"
        + " \n"
        + "å®¢æœï¼š@mmmabc \n"
        ;

      // var inlineKeyboardMarkup = {};
      // inlineKeyboardMarkup.inline_keyboard = [];
      // var keyboardRow = [];
      // var keyboardButton1 = {
      //   text: "ç§Ÿèƒ½é‡",
      //   callback_data: "/trx"
      // };

      // var keyboardButton2 = {
      //   text: "å…‘æ¢TRX",
      //   callback_data: "/trx"
      // };

      // var keyboardRow2 = [];
      // var keyboardButton3 = {
      //   text: "åœ°å€ç›‘æ§",
      //   url: "https://www.google.com"
      // };

      // var keyboardButton4 = {
      //   text: "æ±‡ç‡æŸ¥è¯¢",
      //   url: "https://www.google.com"
      // };

      // keyboardRow.push(keyboardButton1);
      // keyboardRow.push(keyboardButton2);
      // keyboardRow2.push(keyboardButton3);
      // keyboardRow2.push(keyboardButton4);
      // inlineKeyboardMarkup.inline_keyboard.push(keyboardRow);
      // inlineKeyboardMarkup.inline_keyboard.push(keyboardRow2);
      // payload.reply_markup = inlineKeyboardMarkup;

      return payload;
    }

    // payload = {
    //   "method": "sendMessage",
    //   "chat_id": body.message.chat.id,
    //   "text": body.message.text,
    // }

  }
  else if (body.message.sticker) {
    payload = {
      "method": "sendSticker",
      "chat_id": body.message.chat.id,
      "sticker": body.message.sticker.file_id
    }
  }
  else if (body.message.photo) {
    array = body.message.photo;
    text = array[1];
    payload = {
      "method": "sendPhoto",
      "chat_id": body.message.chat.id,
      "photo": text.file_id
    }
  }
  else {
    payload = {
      "method": "sendMessage",
      "chat_id": body.message.chat.id,
      "text": "Try other stuff"
    }
  }
  return payload
}
